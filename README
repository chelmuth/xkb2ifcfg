  XKB to Genode input_filter configuration

  Christian Helmuth

Introduction
############

* assumption pc105 like German keyboard
  - with <LSGT> right of <LFSH> (additional 105th key, code 94)
  - with <BKSL> left of <RTRN> (code 51)
* no support for latching modifiers
  * may become handy with accessibility features
  * input_filter has "sticky" keys already
* What Windows does
  https://docs.microsoft.com/en-us/globalization/keyboards/kbdsg.html


Usage
=====

xkb2ifcfg <command> <layout> <variant> <locale>

Commands

  generate   generate input_filter config
  dump       dump raw XKB keymap
  info       simple per-key information

Example

  xkb2ifcfg generate us ""         en_US.UTF-8
  xkb2ifcfg info     de nodeadkeys de_DE.UTF-8


Open issues
===========

:tool:

* map for pseudo mod2: LEFTCTRL RIGHTCTRL
  * first try xkb_state_key_get_one_sym() with ctrl pressed...
  * should work regardless of mod1 (which it already does - so don't
    break it)
  * map depends on layout, for example, <LCTL>-<AD01> may be
    CTRL-Q on QWERTY and QWERTZ layout, but
    CTRL-A on AZERTY
  * so use the normally generated sym not the keycode...
    https://www.x.org/releases/current/doc/kbproto/xkbproto.html#Interpreting_the_Control_Modifier

    1     01    SOH (start of heading)      CTRL - A
    2     02    STX (start of text)         CTRL - B
    3     03    ETX (end of text)           CTRL - C
    4     04    EOT (end of transmission)   CTRL - D
    5     05    ENQ (enquiry)               CTRL - E
    6     06    ACK (acknowledge)           CTRL - F
    7     07    BEL '\a' (bell)             CTRL - G
    8     08    BS  '\b' (backspace)        CTRL - H
    9     09    HT  '\t' (horizontal tab)   CTRL - I
    10    0A    LF  '\n' (new line)         CTRL - J
    11    0B    VT  '\v' (vertical tab)     CTRL - K
    12    0C    FF  '\f' (form feed)        CTRL - L
    13    0D    CR  '\r' (carriage ret)     CTRL - M
    14    0E    SO  (shift out)             CTRL - N
    15    0F    SI  (shift in)              CTRL - O
    16    10    DLE (data link escape)      CTRL - P
    17    11    DC1 (device control 1)      CTRL - Q
    18    12    DC2 (device control 2)      CTRL - R
    19    13    DC3 (device control 3)      CTRL - S
    20    14    DC4 (device control 4)      CTRL - T
    21    15    NAK (negative ack.)         CTRL - U
    22    16    SYN (synchronous idle)      CTRL - V
    23    17    ETB (end of trans. blk)     CTRL - W
    24    18    CAN (cancel)                CTRL - X
    25    19    EM  (end of medium)         CTRL - Y
    26    1A    SUB (substitute)            CTRL - Z
    27    1B    ESC (escape)                CTRL - [
    28    1C    FS  (file separator)        CTRL - \  '\\'
    29    1D    GS  (group separator)       CTRL - ]
    30    1E    RS  (record separator)      CTRL - ^
    31    1F    US  (unit separator)        CTRL - _

:input_filter:

* use "Unicode combining diacritical marks" U+0300..U+036F in
  <chargen>
* add <sequence> nodes to chargen with object/class (beside <key>
  nodes)
  <sequence first="..." second="..." third="..." fourth="..." code="..."/>
* Cancellation Behavior
  What should happen when a sequence is cancelled?  For example, consider
  there are only the above sequences, and the input kesysms are
  \<dead_acute\> \<b\>.  There are a few approaches:

  Swallow the cancelling keysym; that is, no keysym is produced. This
  is the approach taken by libX11.

* enhance input_filter test for layouts
* include generated and tested example layouts
  * en_us, de_de, ch_de (sg), ch_fr (sf), fr

  xkb2ifcfg generate us ''          en_US.UTF-8
  xkb2ifcfg generate de nodeadkeys  de_DE.UTF-8
  xkb2ifcfg generate ch de          de_CH.UTF-8
  xkb2ifcfg generate ch fr          fr_CH.UTF-8
  xkb2ifcfg generate fr ''          fr_FR.UTF-8
  xkb2ifcfg generate us euro        en_US.UTF-8
  xkb2ifcfg generate gb ''          en_GB.UTF-8



Generation of keyboard-layout PDFs (and other examples)
=======================================================

setxkbmap -print -rules evdev -model pc104 -layout us -variant ""           -option "" | xkbcomp -xkm - - | xkbprint -color -label name - - | ps2pdf - t.pdf
setxkbmap -print -rules evdev -model pc105 -layout de -variant "nodeadkeys" -option "" | xkbcomp -xkm - - | xkbprint -color -label symbols - - | ps2pdf - t.pdf

setxkbmap -print -model pc104 -option -layout us
setxkbmap -print -model pc105 -option -layout de -variant nodeadkeys
setxkbmap -print -model pc105 -option -layout ch -variant de_nodeadkeys
setxkbmap -print -model pc105 -option -layout ch -variant fr_nodeadkeys

setxkbmap -print -model pc105 -option -layout gb
setxkbmap -print -model pc104 -option -layout us -variant euro
setxkbmap -print -model pc104 -option -layout us -variant workman

